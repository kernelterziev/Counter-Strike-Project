{% extends 'base.html' %}

{% block title %}{{ team.name }} - Team Details{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <div class="row">
        <!-- Team Info -->
        <div class="col-lg-4 mb-4">
            <div class="card {% if team.is_professional %}border-warning{% endif %}">
                <div class="card-body text-center">
                    {% if team.logo_url %}
                        <img src="{{ team.logo_url }}" alt="{{ team.name }}"
                             class="mb-3" style="width: 120px; height: 120px; object-fit: contain;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <i class="bi bi-shield-fill display-1 {% if team.is_professional %}text-warning{% else %}text-primary{% endif %} mb-3"
                           style="display: none;"></i>
                    {% elif team.logo %}
                        <img src="{{ team.logo.url }}" alt="{{ team.name }}"
                             class="rounded mb-3" style="width: 120px; height: 120px; object-fit: cover;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <i class="bi bi-shield-fill display-1 {% if team.is_professional %}text-warning{% else %}text-primary{% endif %} mb-3"
                           style="display: none;"></i>
                    {% else %}
                        <i class="bi bi-shield-fill display-1 {% if team.is_professional %}text-warning{% else %}text-primary{% endif %} mb-3"></i>
                    {% endif %}

                    <!-- Team name in bright white -->
                    <h3 class="text-white fw-bold">[{{ team.tag }}] {{ team.name }}</h3>

                    {% if team.is_professional %}
                        <div class="mb-3">
                            <span class="badge bg-warning text-dark fs-6">
                                <i class="bi bi-star-fill me-1"></i>Professional Team
                            </span>
                            {% if team.world_ranking %}
                                <span class="badge bg-success text-white fs-6 ms-2">
                                    #{{ team.world_ranking }} World Ranking
                                </span>
                            {% endif %}
                        </div>
                    {% endif %}

                    <div class="mt-4">
                        {% if team.country %}
                            <div class="mb-3 p-2 rounded" style="background: rgba(0, 212, 255, 0.1);">
                                <span class="text-white fw-bold">Country:</span>
                                <span class="flag-emoji me-1">{{ team.get_country_flag }}</span>
                                <span class="text-primary">{{ team.country }}</span>
                            </div>
                        {% endif %}

                        <div class="mb-3 p-2 rounded" style="background: rgba(255, 204, 0, 0.1);">
                            <i class="bi bi-people text-warning me-2"></i>
                            <span class="text-white fw-bold">Members:</span>
                            <span class="text-warning">{{ members.count }}</span>
                        </div>

                        {% if team.captain %}
                            <div class="mb-3 p-2 rounded" style="background: rgba(255, 107, 53, 0.1);">
                                <i class="bi bi-star text-warning me-2"></i>
                                <span class="text-white fw-bold">Captain:</span>
                                <span class="text-warning">{{ team.captain.username }}</span>
                            </div>
                        {% endif %}

                        {% if team.is_professional and team.prize_money %}
                            <div class="mb-3 p-2 rounded" style="background: rgba(0, 255, 136, 0.1);">
                                <i class="bi bi-currency-dollar text-success me-2"></i>
                                <span class="text-white fw-bold">Prize Money:</span>
                                <span class="text-success">${{ team.prize_money|floatformat:0 }}</span>
                            </div>
                        {% endif %}

                        <!-- Founded date only for community teams -->
                        {% if not team.is_professional %}
                            <div class="mb-3 p-2 rounded" style="background: rgba(0, 255, 136, 0.1);">
                                <i class="bi bi-calendar3 text-success me-2"></i>
                                <span class="text-white fw-bold">Founded:</span>
                                <span class="text-success">{{ team.founded_date|date:"F d, Y" }}</span>
                            </div>
                        {% endif %}

                        <div class="text-center">
                            {% if team.is_active %}
                                <span class="badge bg-success fs-6">Active Team</span>
                            {% else %}
                                <span class="badge bg-secondary fs-6">Inactive</span>
                            {% endif %}
                        </div>
                    </div>

                    {% if team.description %}
                        <div class="mt-4 p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                            <h6 class="text-primary">About Team</h6>
                            <p class="text-white mb-0">{{ team.description }}</p>
                        </div>
                    {% endif %}

                    <!-- Team Actions - Only for community teams -->
                    {% if user.is_authenticated and not team.is_professional %}
                        <div class="mt-4">
                            {% if user == team.captain %}
                                <div class="d-grid gap-2">
                                    <a href="{% url 'team_edit' team.pk %}" class="btn btn-primary">
                                        <i class="bi bi-pencil me-2"></i>Edit Team
                                    </a>
                                    <a href="{% url 'team_roster' team.pk %}" class="btn btn-outline-light">
                                        <i class="bi bi-people me-2"></i>Manage Roster
                                    </a>
                                    <button class="btn btn-danger" onclick="confirmDelete()">
                                        <i class="bi bi-trash me-2"></i>Delete Team
                                    </button>
                                </div>
                            {% else %}
                                <!-- Check if user is member -->
                                {% for membership in members %}
                                    {% if membership.player == user %}
                                        <div class="alert alert-info">
                                            <i class="bi bi-check-circle me-2"></i>You are a member of this team
                                        </div>
                                    {% endif %}
                                {% empty %}
                                    <a href="{% url 'join_team' team.pk %}" class="btn btn-success btn-lg">
                                        <i class="bi bi-plus-circle me-2"></i>Join Team
                                    </a>
                                {% endfor %}
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Team Members & Stats -->
        <div class="col-lg-8">
            <!-- Team Members -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="text-white"><i class="bi bi-people-fill text-primary me-2"></i>Team Members ({{ members.count }})</h5>
                </div>
                <div class="card-body">
                    {% if members %}
                        <div class="row g-3">
                            {% for membership in members %}
                            <div class="col-md-6">
                                <div class="card bg-transparent {% if team.is_professional %}border-warning{% else %}border-primary{% endif %}">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center">
                                            {% if membership.player.avatar %}
                                                <img src="{{ membership.player.avatar.url }}" alt="{{ membership.player.username }}"
                                                     class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;">
                                            {% else %}
                                                <i class="bi bi-person-circle me-3 {% if team.is_professional %}text-warning{% else %}text-primary{% endif %}" style="font-size: 3rem;"></i>
                                            {% endif %}
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 text-white">
                                                    {{ membership.player.username }}
                                                    {% if membership.player == team.captain %}
                                                        <i class="bi bi-star-fill text-warning"></i>
                                                    {% endif %}
                                                </h6>
                                                {% if membership.player.real_name %}
                                                    <small class="text-muted">{{ membership.player.real_name }}</small><br>
                                                {% endif %}
                                                <span class="badge bg-secondary">{{ membership.get_role_display }}</span>
                                                {% if membership.player.rank %}
                                                    <span class="rank-badge ms-1">{{ membership.player.get_rank_display }}</span>
                                                {% endif %}
                                                {% if membership.player.hltv_rating %}
                                                    <span class="badge bg-success ms-1">{{ membership.player.hltv_rating }} Rating</span>
                                                {% endif %}
                                                <!-- REMOVED: Joined date line -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-people display-4 text-muted"></i>
                            <h5 class="text-muted mt-2">No members yet</h5>
                            <p class="text-muted">Be the first to join this team!</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Recent Matches -->
            {% if recent_matches %}
            <div class="card">
                <div class="card-header">
                    <h5 class="text-white"><i class="bi bi-controller text-success me-2"></i>Recent Matches</h5>
                </div>
                <div class="card-body">
                    {% for match in recent_matches %}
                    <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded"
                         style="background: rgba(0, 212, 255, 0.1);">
                        <div>
                            <strong class="text-white">
                                {% if match.team1 == team %}
                                    {{ team.name }} vs {{ match.team2.name }}
                                {% else %}
                                    {{ match.team1.name }} vs {{ team.name }}
                                {% endif %}
                            </strong>
                            <br><small class="text-muted">
                                {{ match.get_map_name_display }} • {{ match.match_date|date:"M d" }}
                            </small>
                        </div>
                        <div class="text-end">
                            {% if match.is_finished %}
                                <span class="fw-bold text-primary">{{ match.team1_score }}:{{ match.team2_score }}</span>
                                {% if match.winner == team %}
                                    <br><span class="badge bg-success">Won</span>
                                {% else %}
                                    <br><span class="badge bg-danger">Lost</span>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-warning text-dark">Ongoing</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal - Only for community teams -->
{% if not team.is_professional %}
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="background: var(--secondary-bg); border: 1px solid var(--border-color);">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>Delete Team
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-white">Are you sure you want to delete <strong>"{{ team.name }}"</strong>?</p>
                <p class="text-warning">This action cannot be undone and will remove all team data!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                <form method="post" action="{% url 'team_delete' team.pk %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-2"></i>Delete Team
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete() {
    var deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
    deleteModal.show();
}
</script>
{% endif %}
{% endblock %}